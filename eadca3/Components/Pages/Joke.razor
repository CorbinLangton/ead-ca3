@page "/joke"
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<PageTitle>Joke</PageTitle>

<p>@JokeObject.value</p>

<button type="button" @onclick='@GenerateJoke'>Generate</button>

<label for="joke-category">Joke Category:</label>
<select name="joke-category" id="joke-category" @ref="jokeCategoryRef" @onchange="getCategory">
    <option value="any">any</option>
    <option value="animal">animal</option>
    <option value="career">career</option>
    <option value="celebrity">celebrity</option>
    <option value="dev">dev</option>
    <option value="explicit">Explicit</option>
    <option value="fashion">Fashion</option>
    <option value="food">Food</option>
    <option value="history">History</option>
    <option value="money">Money</option>
    <option value="movie">Movie</option>
    <option value="music">Music</option>
    <option value="political">Political</option>
    <option value="religion">Religion</option>
    <option value="science">Science</option>
    <option value="sport">Sport</option>
    <option value="travel">Travel</option>
</select>

@code {
    @using System.Net.Http
    @using System.Text
    @using System.Net.Http.Json
    @using System.Web
    @using Newtonsoft.Json.Linq
    @using Newtonsoft.Json

    private ElementReference jokeCategoryRef;
    private string? jokeCategory { get; set; }

    private async Task getCategory(ChangeEventArgs e) {
        jokeCategory = e.Value.ToString();
    }

    public JokeJson JokeObject = new JokeJson();

    public async Task GenerateJoke() {
        if(jokeCategory == "any") {
            try {
                using HttpClient client = new HttpClient();
                var res = await client.GetStringAsync("https://api.chucknorris.io/jokes/random");
                JokeObject = JsonConvert.DeserializeObject<JokeJson>(res);
                StateHasChanged();
            } catch (Exception e){
                Console.WriteLine(e.Message);
            }
        } else {
            try {
                using HttpClient client = new HttpClient();
                var res = await client.GetStringAsync($"https://api.chucknorris.io/jokes/random?category={jokeCategory}");
                JokeObject = JsonConvert.DeserializeObject<JokeJson>(res);
                StateHasChanged();
            } catch (Exception e){
                Console.WriteLine(e.Message);
            }
        }
    }

    public class JokeJson {
        public List<string>? categories { get; set; }
        public string? created_at { get; set; }
        public string? icon_url { get; set; }
        public string? id { get; set; }
        public string? updated_at { get; set; }
        public string? url { get; set; }
        public string? value { get; set; }
    }
}
